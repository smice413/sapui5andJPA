/*!
 * OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['sap/ui/thirdparty/URI','../Element','sap/base/util/UriParameters','sap/base/Log','sap/base/util/extend','sap/ui/core/ThemeCheck','sap/ui/thirdparty/jquery'],function(U,E,a,L,e,T,q){"use strict";var c=window["sap-ui-config"]||{};var s=0;if(c['xx-nosync']==='warn'||/(?:\?|&)sap-ui-xx-nosync=(?:warn)/.exec(window.location.search)){s=1;}if(c['xx-nosync']===true||c['xx-nosync']==='true'||/(?:\?|&)sap-ui-xx-nosync=(?:x|X|true)/.exec(window.location.search)){s=2;}var P={};var p=null;var t=null;var b=[];var B=new U(sap.ui.require.toUrl(""),document.baseURI).origin();var o={};var r=/url[\s]*\('?"?([^\'")]*)'?"?\)/;var u=a.fromQuery(window.location.search).get("sap-ui-xx-no-inline-theming-parameters")!=="true";function d(){p=null;}function f(i,j){var M=r.exec(i);if(M){var k=new U(M[1]);if(k.is("relative")){var N=k.absoluteTo(j).normalize().toString();i="url('"+N+"')";}}return i;}function m(C,N,i){for(var j in N){if(typeof C[j]==="undefined"){C[j]=f(N[j],i);}}return C;}function g(N,i){if(typeof N["default"]!=="object"){N={"default":N,"scopes":{}};}p=p||{};p["default"]=p["default"]||{};p["scopes"]=p["scopes"]||{};m(p["default"],N["default"],i);if(typeof N["scopes"]==="object"){for(var S in N["scopes"]){p["scopes"][S]=p["scopes"][S]||{};m(p["scopes"][S],N["scopes"][S],i);}}}function h(C){q("link[id^=sap-ui-theme-]").each(function(){C(this.getAttribute("id"));});}function l(i){var j=document.getElementById(i);if(!j){L.warning("Could not find stylesheet element with ID",i,"sap.ui.core.theming.Parameters");return;}var S=j.href;var k=new U(S).filename("").query("").toString();var z=T.checkStyle(i);if(!z){L.warning("Parameters have been requested but theme is not applied, yet.","sap.ui.core.theming.Parameters");}if(z&&u){var $=q(j);var D=$.css("background-image");var A=/\(["']?data:text\/plain;utf-8,(.*?)['"]?\)$/i.exec(D);if(A&&A.length>=2){var C=A[1];if(C.charAt(0)!=="{"&&C.charAt(C.length-1)!=="}"){try{C=decodeURIComponent(C);}catch(F){L.warning("Could not decode theme parameters URI from "+S);}}try{var G=JSON.parse(C);g(G,k);return;}catch(F){L.warning("Could not parse theme parameters from "+S+". Loading library-parameters.json as fallback solution.");}}}var H=S.replace(/\/(?:css_variables|library)([^\/.]*)\.(?:css|less)($|[?#])/,function(K,M,N){return"/library-parameters.json"+(N?N:"");});if(s===2){L.error("[nosync] Loading library-parameters.json ignored",H,"sap.ui.core.theming.Parameters");return;}else if(s===1){L.error("[nosync] Loading library-parameters.json with sync XHR",H,"sap.ui.core.theming.Parameters");}var I=new U(k).origin();var W=o[I];var J=[];if(W===undefined){if(H.startsWith(B)){J=[false,true];}else{J=[true,false];}}else{J=[W];}n(H,k,J);}function n(i,k,W){var C=W.shift();var H=C?{"X-Requested-With":"XMLHttpRequest"}:{};q.ajax({url:i,dataType:'json',async:false,xhrFields:{withCredentials:C},headers:H,success:function(z,A,D){var F=new U(k).origin();o[F]=C;if(Array.isArray(z)){for(var j=0;j<z.length;j++){var G=z[j];g(G,k);}}else{g(z,k);}},error:function(j,z,A){L.error("Could not load theme parameters from: "+i,A);if(W.length>0){L.warning("Initial library-parameters.json request failed ('withCredentials="+C+"'; sUrl: '"+i+"').\n"+"Retrying with 'withCredentials="+!C+"'.","sap.ui.core.theming.Parameters");n(i,k,W);}}});}function v(){if(!p){g({},"");t=sap.ui.getCore().getConfiguration().getTheme();h(l);}return p;}function w(){b.forEach(l);b=[];}P._addLibraryTheme=function(i){if(p){b.push("sap-ui-theme-"+i);}};function x(O){var i=v();if(O.scopeName){i=i["scopes"][O.scopeName];}else{i=i["default"];}var j=i[O.parameterName];if(typeof j==="undefined"&&typeof O.parameterName==="string"){var I=O.parameterName.indexOf(":");if(I!==-1){O.parameterName=O.parameterName.substr(I+1);}j=i[O.parameterName];}if(O.loadPendingParameters&&typeof j==="undefined"){w();j=x({parameterName:O.parameterName,scopeName:O.scopeName,loadPendingParameters:false});}return j;}function y(j,S){for(var i=0;i<S.length;i++){var C=S[i];for(var k=0;k<C.length;k++){var z=C[k];var A=x({parameterName:j,scopeName:z});if(A){return A;}}}return x({parameterName:j});}P._getScopes=function(A){if(A&&!p){return;}var i=v();var S=Object.keys(i["scopes"]);return S;};P.getActiveScopesFor=function(i){var S=[];if(i instanceof E){var j=i.getDomRef();w();var k=this._getScopes();if(j){var N=function(z){var A=j.classList;return A&&A.contains(z);};while(j){var F=k.filter(N);if(F.length>0){S.push(F);}j=j.parentNode;}}else{var C=function(z){return typeof i.hasStyleClass==="function"&&i.hasStyleClass(z);};while(i){var F=k.filter(C);if(F.length>0){S.push(F);}i=typeof i.getParent==="function"&&i.getParent();}}}return S;};P.get=function(N,k){var z;if(!sap.ui.getCore().isInitialized()){L.warning("Called sap.ui.core.theming.Parameters.get() before core has been initialized. "+"This could lead to bad performance and sync XHR as inline parameters might not be available, yet. "+"Consider using the API only when required, e.g. onBeforeRendering.");}if(arguments.length===0){w();var A=v();return Object.assign({},A["default"]);}if(!N){return undefined;}if(k instanceof E){w();var S=this.getActiveScopesFor(k);if(typeof N==="string"){return y(N,S);}else if(Array.isArray(N)){var C={};for(var j=0;j<N.length;j++){var D=N[j];C[D]=y(D,S);}return C;}}else{if(typeof N==="string"){z=x({parameterName:N,loadPendingParameters:true});return z;}else if(Array.isArray(N)){var C={};for(var i=0;i<N.length;i++){var D=N[i];C[D]=P.get(D);}return C;}}};P._setOrLoadParameters=function(i){p={"default":{},"scopes":{}};t=sap.ui.getCore().getConfiguration().getTheme();h(function(I){var j=I.substr(13);if(i[j]){e(p["default"],i[j]);}else{l(I);}});};P.reset=function(){var O=arguments[0]===true;if(!O||sap.ui.getCore().getConfiguration().getTheme()!==t){d();}};P._getThemeImage=function(i,F){i=i||"sapUiGlobalLogo";var j=P.get(i);if(j){var k=r.exec(j);if(k){j=k[1];}else if(j==="''"||j==="none"){j=null;}}if(!!F&&!j){return sap.ui.resource('sap.ui.core','themes/base/img/1x1.gif');}return j;};return P;},true);
