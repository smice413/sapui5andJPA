/*
* ! OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
*/
sap.ui.define(["sap/m/Button","sap/m/Bar","sap/m/Title","sap/base/util/merge","sap/m/MessageBox"],function(B,a,T,m,M){"use strict";var r=sap.ui.getCore().getLibraryResourceBundle("sap.ui.mdc");var P={createP13nPopover:function(p,d){return new Promise(function(b,c){sap.ui.require(["sap/m/ResponsivePopover"],function(R){P["_checkSettings"](p,d,c);var o=new R({title:d.title,horizontalScrolling:d.hasOwnProperty("horizontalScrolling")?d.horizontalScrolling:false,verticalScrolling:d.hasOwnProperty("verticalScrolling")?d.verticalScrolling:false,contentWidth:d.contentWidth?d.contentWidth:"24rem",resizable:d.hasOwnProperty("resizable")?d.resizable:true,contentHeight:d.contentHeight?d.contentHeight:"35rem",placement:d.placement?d.placement:"Bottom",content:p,afterClose:d.afterClose?d.afterClose:function(){}});if(d.reset){var C=this._createResetHeader({title:d.title,reset:d.reset.onExecute,idResetButton:d.reset.idButton,warningText:d.reset.warningText});o.setCustomHeader(C);}b(o);},c);});},createP13nDialog:function(p,d){return new Promise(function(b,c){P["_checkSettings"](p,d,c);var i=d.id;sap.ui.require(["sap/m/Dialog","sap/m/Button"],function(D,B){var R=sap.ui.getCore().getLibraryResourceBundle("sap.ui.mdc");var C=new D(i,{title:d.title,horizontalScrolling:d.hasOwnProperty("horizontalScrolling")?d.horizontalScrolling:false,verticalScrolling:d.hasOwnProperty("verticalScrolling")?d.verticalScrolling:true,contentWidth:d.contentWidth?d.contentWidth:"40rem",contentHeight:d.contentHeight?d.contentHeight:"55rem",draggable:true,resizable:true,stretch:"{device>/system/phone}",content:p,buttons:[new B(i?i+"-confirmBtn":undefined,{text:d.confirm&&d.confirm.text?d.confirm.text:R.getText("p13nDialog.OK"),type:"Emphasized",press:function(){if(d.confirm&&d.confirm.handler){d.confirm.handler.apply(C,arguments);}}}),new B(i?i+"-cancelBtn":undefined,{text:R.getText("p13nDialog.CANCEL"),press:function(){d.cancel.apply(C,arguments);}})]});if(d.reset){var o=P._createResetHeader({title:d.title,idResetButton:d.reset.idButton,reset:d.reset.onExecute,warningText:d.reset.warningText});C.setCustomHeader(o);}var A=d.additionalButtons;if(A instanceof Array){A.forEach(function(e){if(!e.isA("sap.m.Button")){c("Please only provide sap.m.Button instances as 'additionalButtons'");}C.addButton(e);});}b(C);},c);});},_createResetHeader:function(s){var b=new a({contentLeft:[new T({text:s.title})]});if(s.reset){var i=s.idResetButton;b.addContentRight(new B(i,{text:sap.ui.getCore().getLibraryResourceBundle("sap.ui.mdc").getText("p13nDialog.RESET"),press:function(){var R=s.warningText?s.warningText:sap.ui.getCore().getLibraryResourceBundle("sap.ui.mdc").getText("filterbar.ADAPT_RESET_WARNING");M.warning(R,{actions:[M.Action.OK,M.Action.CANCEL],emphasizedAction:M.Action.OK,onClose:function(A){if(A===M.Action.OK){s.reset();}}});}}));}return b;},prepareP13nData:function(c,i,I,p){I=I?I:[];var b=[],d={};var e=c.items||[];var s=c.sorters||[];var E=this.arrayToMap(e);var f=this.arrayToMap(s);var g=c.filter||{};i.forEach(function(o){var h={};if(P._isExcludeProperty(o,I)){return;}var k=o.name;var j=E[k];h.selected=j?true:false;h.position=j?j.position:-1;h=m(h,o,j);h.label=o.label||o.name;h.tooltip=o.tooltip?o.tooltip:o.label;h.visibleInDialog=o.hasOwnProperty("visibleInDialog")?o.visibleInDialog:true;if(p=="Sort"){h.isSorted=f[k]?true:false;h.sortPosition=f[k]?f[k].position:-1;h.descending=f[k]?f[k].descending:false;}if(c.filter){var l=g[k];h.isFiltered=l&&l.length>0?true:false;}h.group=h.group?h.group:"BASIC";d[h.group]=d[h.group]?d[h.group]:[];d[h.group].push(h);b.push(h);});if(p){this._sortP13nData(p,b);}return{items:b,itemsGrouped:this._builtGroupStructure(d)};},_sortP13nData:function(p,i){var b=this._getSortAttributes()[p];var s=b.position;var S=b.visible;var l=sap.ui.getCore().getConfiguration().getLocale().toString();var c=window.Intl.Collator(l,{});i.sort(function(f,F){if(f[S]&&F[S]){return(f[s]||0)-(F[s]||0);}else if(f[S]){return-1;}else if(F[S]){return 1;}else if(!f[S]&&!F[S]){return c.compare(f.label,F.label);}});},_getSortAttributes:function(){return{Item:{position:"position",visible:"selected"},Sort:{position:"sortPosition",visible:"isSorted"},Filter:{position:"position",visible:"selected"},generic:{position:undefined,visible:undefined}};},_builtGroupStructure:function(i){var g=[];Object.keys(i).forEach(function(G){this._sortP13nData("generic",i[G]);g.push({group:G,groupLabel:i[G][0].groupLabel||r.getText("p13nDialog.FILTER_DEFAULT_GROUP"),groupVisible:true,items:i[G]});}.bind(this));return g;},_isExcludeProperty:function(p,i){return i.some(function(k){var I=k.ignoreKey;var v=k.ignoreValue;return p[I]===v;});},_checkSettings:function(p,d,o){if(!d){o("Please provide a settings object for p13n creation");}if(!d.title&&!d.customHeader){o("Please provide a title or customHeader in the settings object for p13n creation");}},arrayToMap:function(A){return A.reduce(function(b,p,i){b[p.name]=p;b[p.name].position=i;return b;},{});}};return P;});
