/*
 * ! OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/fl/apply/_internal/flexState/FlexState","sap/ui/fl/apply/_internal/flexState/ManifestUtils","sap/ui/fl/apply/_internal/ChangesController","sap/ui/fl/Change","sap/ui/fl/registry/Settings","sap/ui/fl/Utils","sap/ui/fl/LayerUtils"],function(F,M,C,a,S,U,L){"use strict";function g(o){return o&&o.getPersistencyKey&&o.getPersistencyKey();}function b(o){var r=M.getFlexReferenceForControl(o);var p=g(o);var m=F.getCompVariantsMap(r);return m._getOrCreate(p);}var c={getCompEntities:function(p){var r=M.getFlexReferenceForControl(p.control);return F.initialize({reference:r,componentData:{},manifest:U.getAppDescriptor(p.control),componentId:U.getAppComponentForControl(p.control).getId()}).then(b.bind(undefined,p.control));},loadChanges:function(p){return c.getCompEntities(p).then(function(o){return o.variants.concat(o.changes);});},getEntityById:function(p){var r=M.getFlexReferenceForControl(p.control);return F.getCompEntitiesByIdMap(r)[p.id];},isVariantSharingEnabled:function(){return S.getInstance().then(function(i){return i.isVariantSharingEnabled();});},isApplicationVariant:function(p){var o=p.control;if(U.isApplicationVariant(o)){return true;}var d=U.getComponentForControl(o);if(d&&d.getAppComponent){d=d.getAppComponent();if(d){return true;}}return false;},isVendorLayer:function(){return L.isVendorLayer();},isVariantDownport:function(){return c.isVendorLayer()&&U.isHotfixMode();},getDefaultVariantId:function(p){var o=b(p.control).defaultVariant;return o?o.getContent().defaultVariantName:"";},getExecuteOnSelect:function(p){var o=b(p.control).standardVariant;return o?o.getContent().executeOnSelect:null;},getChangeById:function(p){return c.getEntityById(p);},_getChangeMap:function(o){var r=M.getFlexReferenceForControl(o);var p=g(o);var m=F.getCompEntitiesByIdMap(r);var d={};Object.keys(m).forEach(function(i){if(m[i].getSelector&&m[i].getSelector().persistencyKey===p&&m[i].getFileType()==="change"){d[i]=m[i];}});return d;}};return c;},true);
