/*
 * ! OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/mdc/TableDelegate",'sap/ui/core/Core','sap/ui/mdc/util/FilterUtil','sap/ui/mdc/odata/v4/util/DelegateUtil','sap/ui/mdc/odata/v4/FilterBarDelegate','./ODataMetaModelUtil','sap/ui/mdc/odata/v4/TypeUtil','sap/ui/model/Filter','sap/base/Log'],function(T,C,F,D,a,O,b,c,L){"use strict";var d=Object.assign({},T);d.fetchProperties=function(t){var m=t.getDelegate().payload,M;M=t.getModel(m.model);return new Promise(function(r){if(!M){t.attachModelContextChange({resolver:r},o);}else{e(t,M).then(r);}});};function o(E,f){var t=E.getSource();var m=t.getDelegate().payload;var M=t.getModel(m.model);if(M){e(t,M).then(f.resolver);t.detachModelContextChange(o);}}function e(t,m){var M=t.getDelegate().payload,p=[],P,f,g;var E="/"+M.collectionName;var h=m.getMetaModel();return Promise.all([h.requestObject(E+"/"),h.requestObject(E+"@")]).then(function(r){var i=r[0],j=r[1];var s=j["@Org.OData.Capabilities.V1.SortRestrictions"]||{};var S=O.getSortRestrictionsInfo(s);var k=j["@Org.OData.Capabilities.V1.FilterRestrictions"];var l=O.getFilterRestrictionsInfo(k);for(var K in i){f=i[K];if(f&&f.$kind==="Property"){if(f.$isCollection){L.warning("Complex property with type "+f.$Type+" has been ignored");continue;}g=h.getObject(E+"/"+K+"@");P={name:K,label:g["@com.sap.vocabularies.Common.v1.Label"]||K,description:g["@com.sap.vocabularies.Common.v1.Text"]&&g["@com.sap.vocabularies.Common.v1.Text"].$Path,maxLength:f.$MaxLength,precision:f.$Precision,scale:f.$Scale,type:f.$Type,sortable:S[K]?S[K].sortable:true,filterable:l[K]?l[K].filterable:true,typeConfig:t.getTypeUtil().getTypeConfig(f.$Type),fieldHelp:undefined,maxConditions:O.isMultiValueFilterExpression(l.propertyInfo[K])?-1:1};p.push(P);}}t.data("$tablePropertyInfo",p);return p;});}d.updateBindingInfo=function(m,M,B){if(!m){return;}if(M&&B){B.path=B.path||M.collectionPath||"/"+M.collectionName;B.model=B.model||M.model;}if(!B){B={};}var f=C.byId(m.getFilter()),g=m.isFilteringEnabled(),h;var i,j;var k=[];if(g){h=m.getConditions();var t=m.data("$tablePropertyInfo");i=F.getFilterInfo(m,h,t);if(i.filters){k.push(i.filters);}}if(f){h=f.getConditions();if(h){var p=f.getPropertyInfoSet?f.getPropertyInfoSet():null;var P=D.getParameterNames(f);j=F.getFilterInfo(f,h,p,P);if(j.filters){k.push(j.filters);}var s=D.getParametersInfo(f,h);if(s){B.path=s;}}var S=f.getSearch();if(S){if(!B.parameters){B.parameters={};}B.parameters.$search=S;}}B.filters=new c(k,true);};d.getFilterDelegate=function(){return{addFilterItem:function(p,t){return a._createFilterField(p,t);}};};d.getTypeUtil=function(p){return b;};return d;});
